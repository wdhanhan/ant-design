{"version":3,"sources":[".dumi/hooks/useThemeAnimation.ts",".dumi/theme/common/ThemeSwitch/index.tsx",".dumi/theme/common/ThemeSwitch/ThemeIcon.tsx"],"sourcesContent":["import { useEffect, useRef } from 'react';\nimport { removeCSS, updateCSS } from 'rc-util/lib/Dom/dynamicCSS';\n\nimport theme from '../../components/theme';\n\nconst viewTransitionStyle = `\n::view-transition-old(root),\n::view-transition-new(root) {\n  animation: none;\n  mix-blend-mode: normal;\n}\n\n.dark::view-transition-old(root) {\n  z-index: 1;\n}\n\n.dark::view-transition-new(root) {\n  z-index: 999;\n}\n\n::view-transition-old(root) {\n  z-index: 999;\n}\n\n::view-transition-new(root) {\n  z-index: 1;\n}\n`;\n\nconst useThemeAnimation = () => {\n  const {\n    token: { colorBgElevated },\n  } = theme.useToken();\n\n  const animateRef = useRef<{ colorBgElevated: string }>({ colorBgElevated });\n\n  const startAnimationTheme = (clipPath: string[], isDark: boolean) => {\n    updateCSS(\n      `\n    * {\n    transition: none !important;\n  }\n    `,\n      'disable-transition',\n    );\n\n    document.documentElement\n      .animate(\n        {\n          clipPath: isDark ? [...clipPath].reverse() : clipPath,\n        },\n        {\n          duration: 500,\n          easing: 'ease-in',\n          pseudoElement: isDark ? '::view-transition-old(root)' : '::view-transition-new(root)',\n        },\n      )\n      .addEventListener('finish', () => {\n        removeCSS('disable-transition');\n      });\n  };\n\n  const toggleAnimationTheme = (\n    event: React.MouseEvent<HTMLElement, MouseEvent>,\n    isDark: boolean,\n  ) => {\n    // @ts-ignore\n    if (!(event && typeof document.startViewTransition === 'function')) {\n      return;\n    }\n    const time = Date.now();\n    const x = event.clientX;\n    const y = event.clientY;\n    const endRadius = Math.hypot(Math.max(x, innerWidth - x), Math.max(y, innerHeight - y));\n    updateCSS(\n      `\n    [data-prefers-color='dark'] {\n      color-scheme: light !important;\n    }\n\n    [data-prefers-color='light'] {\n      color-scheme: dark !important;\n    }\n    `,\n      'color-scheme',\n    );\n    document\n      // @ts-ignore\n      .startViewTransition(async () => {\n        // wait for theme change end\n        while (colorBgElevated === animateRef.current.colorBgElevated) {\n          // eslint-disable-next-line no-await-in-loop\n          await new Promise((resolve) => {\n            setTimeout(resolve, 1000 / 60);\n          });\n        }\n        const root = document.documentElement;\n        root.classList.remove(isDark ? 'dark' : 'light');\n        root.classList.add(isDark ? 'light' : 'dark');\n      })\n      .ready.then(() => {\n        console.log(`Theme transition finished in ${Date.now() - time}ms`);\n        const clipPath = [\n          `circle(0px at ${x}px ${y}px)`,\n          `circle(${endRadius}px at ${x}px ${y}px)`,\n        ];\n        removeCSS('color-scheme');\n        startAnimationTheme(clipPath, isDark);\n      });\n  };\n\n  // inject transition style\n  useEffect(() => {\n    // @ts-ignore\n    if (typeof document.startViewTransition === 'function') {\n      updateCSS(viewTransitionStyle, 'view-transition-style');\n    }\n  }, []);\n\n  useEffect(() => {\n    if (colorBgElevated !== animateRef.current.colorBgElevated) {\n      animateRef.current.colorBgElevated = colorBgElevated;\n    }\n  }, [colorBgElevated]);\n\n  return toggleAnimationTheme;\n};\n\nexport default useThemeAnimation;\n","import React from 'react';\nimport { BgColorsOutlined, SmileOutlined } from '@ant-design/icons';\nimport { FloatButton } from 'antd';\nimport { useTheme } from 'antd-style';\nimport { CompactTheme, DarkTheme } from 'antd-token-previewer/es/icons';\n// import { Motion } from 'antd-token-previewer/es/icons';\nimport { FormattedMessage, useLocation } from 'dumi';\n\nimport useThemeAnimation from '../../../hooks/useThemeAnimation';\nimport { getLocalizedPathname, isZhCN } from '../../utils';\nimport Link from '../Link';\nimport ThemeIcon from './ThemeIcon';\n\nexport type ThemeName = 'light' | 'dark' | 'compact' | 'motion-off' | 'happy-work';\n\nexport interface ThemeSwitchProps {\n  value?: ThemeName[];\n  onChange: (value: ThemeName[]) => void;\n}\n\nconst ThemeSwitch: React.FC<ThemeSwitchProps> = (props) => {\n  const { value = ['light'], onChange } = props;\n  const token = useTheme();\n  const { pathname, search } = useLocation();\n\n  // const isMotionOff = value.includes('motion-off');\n  const isHappyWork = value.includes('happy-work');\n  const isDark = value.includes('dark');\n\n  const toggleAnimationTheme = useThemeAnimation();\n\n  return (\n    <FloatButton.Group\n      trigger=\"click\"\n      icon={<ThemeIcon />}\n      aria-label=\"Theme Switcher\"\n      badge={{ dot: true }}\n    >\n      <Link\n        to={getLocalizedPathname('/theme-editor', isZhCN(pathname), search)}\n        style={{ display: 'block', marginBottom: token.margin }}\n      >\n        <FloatButton\n          icon={<BgColorsOutlined />}\n          tooltip={<FormattedMessage id=\"app.footer.theme\" />}\n        />\n      </Link>\n      <FloatButton\n        icon={<DarkTheme />}\n        type={isDark ? 'primary' : 'default'}\n        onClick={(e) => {\n          // Toggle animation when switch theme\n          toggleAnimationTheme(e, isDark);\n\n          if (isDark) {\n            onChange(value.filter((theme) => theme !== 'dark'));\n          } else {\n            onChange([...value, 'dark']);\n          }\n        }}\n        tooltip={<FormattedMessage id=\"app.theme.switch.dark\" />}\n      />\n      <FloatButton\n        icon={<CompactTheme />}\n        type={value.includes('compact') ? 'primary' : 'default'}\n        onClick={() => {\n          if (value.includes('compact')) {\n            onChange(value.filter((theme) => theme !== 'compact'));\n          } else {\n            onChange([...value, 'compact']);\n          }\n        }}\n        tooltip={<FormattedMessage id=\"app.theme.switch.compact\" />}\n      />\n      <FloatButton\n        badge={{ dot: true }}\n        icon={<SmileOutlined />}\n        type={isHappyWork ? 'primary' : 'default'}\n        onClick={() => {\n          if (isHappyWork) {\n            onChange(value.filter((theme) => theme !== 'happy-work'));\n          } else {\n            onChange([...value, 'happy-work']);\n          }\n        }}\n        tooltip={\n          <FormattedMessage\n            id={isHappyWork ? 'app.theme.switch.happy-work.off' : 'app.theme.switch.happy-work.on'}\n          />\n        }\n      />\n    </FloatButton.Group>\n  );\n};\n\nexport default ThemeSwitch;\n","import React from 'react';\nimport Icon from '@ant-design/icons';\n\nconst ThemeIcon: React.FC<{ className?: string }> = (props) => {\n  const SVGIcon = React.useCallback(\n    () => (\n      <svg width={20} height={20} viewBox=\"0 0 24 24\" fill=\"currentColor\" {...props}>\n        <title>Theme icon</title>\n        <g fillRule=\"evenodd\">\n          <g fillRule=\"nonzero\">\n            <path d=\"M7.02 3.635l12.518 12.518a1.863 1.863 0 010 2.635l-1.317 1.318a1.863 1.863 0 01-2.635 0L3.068 7.588A2.795 2.795 0 117.02 3.635zm2.09 14.428a.932.932 0 110 1.864.932.932 0 010-1.864zm-.043-9.747L7.75 9.635l9.154 9.153 1.318-1.317-9.154-9.155zM3.52 12.473c.514 0 .931.417.931.931v.932h.932a.932.932 0 110 1.864h-.932v.931a.932.932 0 01-1.863 0l-.001-.931h-.93a.932.932 0 010-1.864h.93v-.932c0-.514.418-.931.933-.931zm15.374-3.727a1.398 1.398 0 110 2.795 1.398 1.398 0 010-2.795zM4.385 4.953a.932.932 0 000 1.317l2.046 2.047L7.75 7 5.703 4.953a.932.932 0 00-1.318 0zM14.701.36a.932.932 0 01.931.932v.931h.932a.932.932 0 010 1.864h-.933l.001.932a.932.932 0 11-1.863 0l-.001-.932h-.93a.932.932 0 110-1.864h.93v-.931a.932.932 0 01.933-.932z\" />\n          </g>\n        </g>\n      </svg>\n    ),\n    [props],\n  );\n  return <Icon component={SVGIcon} {...props} />;\n};\n\nexport default ThemeIcon;\n"],"names":[],"mappings":"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"}