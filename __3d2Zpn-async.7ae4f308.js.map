{"version":3,"sources":["node_modules/@codesandbox/sandpack-client/dist/index-585bceb7.mjs"],"sourcesContent":["import { g as __extends, _ as __awaiter, a as __generator } from './utils-52664384.mjs';\nimport { PreviewController } from 'static-browser-server';\nimport { E as EventEmitter, c as consoleHook, g as generateRandomId, f as fromBundlerFilesToFS } from './consoleHook-59e792cb.mjs';\nimport { S as SandpackClient } from './base-80a1f760.mjs';\nimport 'outvariant';\nimport 'dequal';\n\nvar insertHtmlAfterRegex = function (regex, content, insertable) {\n    var match = regex.exec(content);\n    if (match && match.length >= 1) {\n        var offset = match.index + match[0].length;\n        var prefix = content.substring(0, offset);\n        var suffix = content.substring(offset);\n        return prefix + insertable + suffix;\n    }\n};\nvar readBuffer = function (content) {\n    if (typeof content === \"string\") {\n        return content;\n    }\n    else {\n        return new TextDecoder().decode(content);\n    }\n};\nvar validateHtml = function (content) {\n    // Make it a string\n    var contentString = readBuffer(content);\n    var domParser = new DOMParser();\n    var doc = domParser.parseFromString(contentString, \"text/html\");\n    if (!doc.documentElement.getAttribute(\"lang\")) {\n        doc.documentElement.setAttribute(\"lang\", \"en\");\n    }\n    var html = doc.documentElement.outerHTML;\n    return \"<!DOCTYPE html>\\n\".concat(html);\n};\n\nvar SandpackStatic = /** @class */ (function (_super) {\n    __extends(SandpackStatic, _super);\n    function SandpackStatic(selector, sandboxSetup, options) {\n        if (options === void 0) { options = {}; }\n        var _a;\n        var _this = _super.call(this, selector, sandboxSetup, options) || this;\n        _this.files = new Map();\n        _this.status = \"initializing\";\n        _this.emitter = new EventEmitter();\n        _this.previewController = new PreviewController({\n            baseUrl: (_a = options.bundlerURL) !== null && _a !== void 0 ? _a : \"https://preview.sandpack-static-server.codesandbox.io\",\n            // filepath is always normalized to start with / and not end with a slash\n            getFileContent: function (filepath) {\n                var content = _this.files.get(filepath);\n                if (!content) {\n                    throw new Error(\"File not found\");\n                }\n                if (filepath.endsWith(\".html\") || filepath.endsWith(\".htm\")) {\n                    try {\n                        content = validateHtml(content);\n                        content = _this.injectProtocolScript(content);\n                        content = _this.injectExternalResources(content, options.externalResources);\n                        content = _this.injectScriptIntoHead(content, {\n                            script: consoleHook,\n                            scope: { channelId: generateRandomId() },\n                        });\n                    }\n                    catch (err) {\n                        console.error(\"Runtime injection failed\", err);\n                    }\n                }\n                return content;\n            },\n        });\n        if (typeof selector === \"string\") {\n            _this.selector = selector;\n            var element = document.querySelector(selector);\n            _this.element = element;\n            _this.iframe = document.createElement(\"iframe\");\n        }\n        else {\n            _this.element = selector;\n            _this.iframe = selector;\n        }\n        if (!_this.iframe.getAttribute(\"sandbox\")) {\n            _this.iframe.setAttribute(\"sandbox\", \"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts allow-downloads allow-pointer-lock\");\n            _this.iframe.setAttribute(\"allow\", \"accelerometer; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; clipboard-write;\");\n        }\n        _this.eventListener = _this.eventListener.bind(_this);\n        if (typeof window !== \"undefined\") {\n            window.addEventListener(\"message\", _this.eventListener);\n        }\n        // Dispatch very first compile action\n        _this.updateSandbox();\n        return _this;\n    }\n    SandpackStatic.prototype.injectContentIntoHead = function (content, contentToInsert) {\n        var _a;\n        // Make it a string\n        content = readBuffer(content);\n        // Inject script\n        content =\n            (_a = insertHtmlAfterRegex(/<head[^<>]*>/g, content, \"\\n\" + contentToInsert)) !== null && _a !== void 0 ? _a : contentToInsert + \"\\n\" + content;\n        return content;\n    };\n    SandpackStatic.prototype.injectProtocolScript = function (content) {\n        var scriptToInsert = \"<script>\\n  window.addEventListener(\\\"message\\\", (message) => {\\n    if(message.data.type === \\\"refresh\\\") {\\n      window.location.reload();\\n    }\\n  })\\n</script>\";\n        return this.injectContentIntoHead(content, scriptToInsert);\n    };\n    SandpackStatic.prototype.injectExternalResources = function (content, externalResources) {\n        if (externalResources === void 0) { externalResources = []; }\n        var tagsToInsert = externalResources\n            .map(function (resource) {\n            var match = resource.match(/\\.([^.]*)$/);\n            var fileType = match === null || match === void 0 ? void 0 : match[1];\n            if (fileType === \"css\" || resource.includes(\"fonts.googleapis\")) {\n                return \"<link rel=\\\"stylesheet\\\" href=\\\"\".concat(resource, \"\\\">\");\n            }\n            if (fileType === \"js\") {\n                return \"<script src=\\\"\".concat(resource, \"\\\"></script>\");\n            }\n            throw new Error(\"Unable to determine file type for external resource: \".concat(resource));\n        })\n            .join(\"\\n\");\n        return this.injectContentIntoHead(content, tagsToInsert);\n    };\n    SandpackStatic.prototype.injectScriptIntoHead = function (content, opts) {\n        var script = opts.script, _a = opts.scope, scope = _a === void 0 ? {} : _a;\n        var scriptToInsert = \"\\n    <script>\\n      const scope = \".concat(JSON.stringify(scope), \";\\n      \").concat(script, \"\\n    </script>\\n    \").trim();\n        return this.injectContentIntoHead(content, scriptToInsert);\n    };\n    SandpackStatic.prototype.updateSandbox = function (setup, _isInitializationCompile) {\n        if (setup === void 0) { setup = this.sandboxSetup; }\n        var modules = fromBundlerFilesToFS(setup.files);\n        /**\n         * Pass init files to the bundler\n         */\n        this.dispatch({\n            codesandbox: true,\n            modules: modules,\n            template: setup.template,\n            type: \"compile\",\n        });\n    };\n    SandpackStatic.prototype.compile = function (files) {\n        return __awaiter(this, void 0, void 0, function () {\n            var previewUrl;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.files = new Map(Object.entries(files));\n                        return [4 /*yield*/, this.previewController.initPreview()];\n                    case 1:\n                        previewUrl = _a.sent();\n                        this.iframe.setAttribute(\"src\", previewUrl);\n                        this.status = \"done\";\n                        this.dispatch({ type: \"done\", compilatonError: false });\n                        this.dispatch({\n                            type: \"urlchange\",\n                            url: previewUrl,\n                            back: false,\n                            forward: false,\n                        });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    // Handles message windows coming from iframes\n    SandpackStatic.prototype.eventListener = function (evt) {\n        // skip events originating from different iframes\n        if (evt.source !== this.iframe.contentWindow) {\n            return;\n        }\n        var message = evt.data;\n        if (!message.codesandbox) {\n            return;\n        }\n        this.dispatch(message);\n    };\n    /**\n     * Bundler communication\n     */\n    SandpackStatic.prototype.dispatch = function (message) {\n        var _a;\n        switch (message.type) {\n            case \"compile\":\n                this.compile(message.modules);\n                break;\n            default:\n                (_a = this.iframe.contentWindow) === null || _a === void 0 ? void 0 : _a.postMessage(message, \"*\");\n                this.emitter.dispatch(message);\n        }\n    };\n    SandpackStatic.prototype.listen = function (listener) {\n        return this.emitter.listener(listener);\n    };\n    SandpackStatic.prototype.destroy = function () {\n        this.emitter.cleanup();\n        if (typeof window !== \"undefined\") {\n            window.removeEventListener(\"message\", this.eventListener);\n        }\n    };\n    return SandpackStatic;\n}(SandpackClient));\n\nexport { SandpackStatic };\n"],"names":[],"mappings":"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"}